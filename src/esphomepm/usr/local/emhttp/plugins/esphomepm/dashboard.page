Menu="Dashboard:0"
---
<?php
// Define plugin name and other variables
$pluginname = "ESPHome Power Monitor";

// Create the dashboard widget content - absolute minimum
$mytiles['esphomepm']['column1'] = <<<EOT
<tbody title="$pluginname">
<tr>
    <td><i class="fa fa-plug icon"></i>
        <div class='section'>$pluginname<span><br>
            <span class="esphomepm-current-power">0</span> W
        </span></div>
        <a href="/Settings/ESPHomePMSettings" title="Go to ESPHome Power Monitor settings"><i class="fa fa-fw fa-cog control"></i></a>
    </td>
</tr>
</tbody>
EOT;
?>

<script>
$(function() {
  // Simple function to update the power value
  function updatePower() {
    $.getJSON('/plugins/esphomepm/status.php', function(data) {
      if (data && data.power) {
        $('.esphomepm-current-power').html(data.power);
      }
    });
  }
  
  // Update on page load
  updatePower();
  
  // Update every 10 seconds
  setInterval(updatePower, 10000);
});
</script>